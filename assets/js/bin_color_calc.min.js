$(document).ready(function(){function e(e){var t=new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}),l=document.createElement("a");l.setAttribute("download","bin-doma.ru_colors.png"),l.setAttribute("href",e),l.setAttribute("target","_blank"),l.dispatchEvent(t)}function t(){for(id in o)o[id]&&($("#"+id).css("opacity","1"),$("#"+id+" .cls-area").css({fill:o[id].color,opacity:"0.7"}))}function l(e){let t=$(".js-bin_calc-panel__list");for(let l=0;l<e.areas.length;l++)o[e.areas[l].svg_id]={},$("<li></li>").addClass("bin_calc-panel__list-item").attr({"data-svg":e.areas[l].svg_id,"data-color":e.areas[l].color_type}).text(e.areas[l].name).appendTo(t)}function a(e){let t=["colors","roofs","windows","under_roofs","seal"];for(let l=0;l<t.length;l++){const a=t[l];let o=$(".js-bin_calc-panel__colors[data-type='"+a+"']"),i=e[a],c=[];for(let e=0;e<i.length;e++){let t=$("<li></li>").addClass("bin_calc-panel__colors-item").attr({"data-rgb":i[e].rgb,"data-group":i[e].group,"data-color_id":a+e,title:i[e].color});i[e].image&&$("<img />").attr("src",i[e].image).appendTo(t),i[e].opacity&&t.attr("data-opacity",i[e].opacity),i[e].group.length?(Object.keys(c).includes(i[e].group)||(c[i[e].group]=[],c[i[e].group].push($("<div></div>").addClass("bin_calc-panel__colors-group").text(i[e].group))),c[i[e].group].push(t)):(Object.keys(c).includes("other")||(c.other=[],c.other.push($("<div></div>").addClass("bin_calc-panel__colors-group"))),c.other.push(t))}for(g in c)$.each(c[g],function(e,t){t.appendTo(o)})}}var o={};$(document).on("click",".js-download",function(t){t.preventDefault();let l=[];for(c in o)o[c].color_id&&l.push(o[c]);var a=document.getElementById("canvas"),i=document.getElementById("house"),n=a.getContext("2d"),s=(new XMLSerializer).serializeToString(i),r=window.URL||window.webkitURL||window,_=new Image,d=new Blob([s],{type:"image/svg+xml;charset=utf-8"}),p=r.createObjectURL(d);let g={w:1900,h:950,footer_columns:2};g.footer_rows=Math.ceil(l.length/2),g.footer_h=l.length?40*g.footer_rows+120:0;let b="www.bin-doma.ru";_.src=p,_.onload=function(){a.width=g.w,a.height=g.h+g.footer_h,n.globalAlpha=1,n.drawImage(_,0,0,g.w,g.h);let t=new Image(100,89);t.src="/assets/images/style/logo-new.png",t.onload=function(){if(n.globalAlpha=.7,n.drawImage(t,50,g.h-100),n.globalAlpha=1,l.length){n.fillStyle="rgb(255,255,255)",n.fillRect(0,g.h,g.w,g.footer_h),n.fillStyle="rgb(255, 87, 34)",n.fillRect(0,g.h,g.w,10),n.font="28px sans-serif",n.fillStyle="rgb(102, 102, 102)";let e=Math.floor(n.measureText(b).width)+40;n.fillText(b,g.w-e,g.h+g.footer_h-40),n.fillStyle="rgb(20,20,20)";let t=g.h+70,a=50,o=Math.floor(g.w/g.footer_columns),i=40;for(let e=0;e<l.length;e++){let c=l[e].group?l[e].group+" - ":"";text=`${l[e].zone}: ${c}${l[e].name}`,n.fillText(text,a+Math.floor(e/g.footer_rows)*o,t+e%g.footer_rows*i)}}r.revokeObjectURL(p);var o=a.toDataURL("image/png").replace("image/png","image/octet-stream");e(o)}}}),$(document).on("click",".bin_calc-panel__list-item",function(e){let t=$(this).data("color"),l=$(this).data("svg");$(this).addClass("bin_calc-panel__list-item--active").siblings().removeClass("bin_calc-panel__list-item--active"),$(".js-bin_calc-panel__colors[data-type='"+t+"']").addClass("bin_calc-panel__colors--active").siblings().removeClass("bin_calc-panel__colors--active"),$(".js-bin_calc-panel__colors[data-type='"+t+"'] .bin_calc-panel__colors-item").removeClass("bin_calc-panel__colors-item--active"),o[l].color&&$(".js-bin_calc-panel__colors[data-type='"+t+"'] .bin_calc-panel__colors-item[data-color_id='"+o[l].color_id+"']").addClass("bin_calc-panel__colors-item--active")}),$(document).on("click",".bin_calc-panel__colors-item",function(e){let l=$(".bin_calc-panel__list-item--active").data("svg");$(this).hasClass("bin_calc-panel__colors-item--active")?(o[l]={},o[l].color="none",$(this).removeClass("bin_calc-panel__colors-item--active"),$(".bin_calc-panel__list-item.bin_calc-panel__list-item--active").removeClass("bin_calc-panel__list-item--selected")):(o[l].zone=$(".bin_calc-panel__list-item.bin_calc-panel__list-item--active").text(),o[l].color=$(this).data("rgb"),o[l].color_id=$(this).data("color_id"),o[l].group=$(this).data("group"),o[l].name=$(this).attr("title"),$(this).addClass("bin_calc-panel__colors-item--active").siblings().removeClass("bin_calc-panel__colors-item--active"),$(".bin_calc-panel__list-item.bin_calc-panel__list-item--active").addClass("bin_calc-panel__list-item--selected")),t()}),$.getJSON("/assets/js/bin_calc_colors.json",function(e){l(e),a(e)})});