$(document).ready(function(){function e(e){var a=new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}),t=document.createElement("a");t.setAttribute("download","bin-doma.ru_colors.png"),t.setAttribute("href",e),t.setAttribute("target","_blank"),t.dispatchEvent(a)}function a(){for(id in c)c[id]&&($("#"+id).css("opacity","1"),$("#"+id+" .cls-area").css({fill:c[id].color,opacity:"0.7"}))}function t(e){let a=$(".js-bin_calc-panel__list");for(let t=0;t<e.areas.length;t++)c[e.areas[t].svg_id]={},$("<li></li>").addClass("bin_calc-panel__list-item").attr({"data-svg":e.areas[t].svg_id,"data-color":e.areas[t].color_type}).text(e.areas[t].name).appendTo(a)}function l(e){let a=["colors","roofs","windows","under_roofs","seal"];for(let t=0;t<a.length;t++){const l=a[t];let c=$(".js-bin_calc-panel__colors[data-type='"+l+"']"),i=e[l];for(let e=0;e<i.length;e++){let a=$("<li></li>").addClass("bin_calc-panel__colors-item").attr({"data-rgb":i[e].rgb,"data-color_id":l+e,title:i[e].color});i[e].image&&$("<img />").attr("src",i[e].image).appendTo(a),i[e].opacity&&a.attr("data-opacity",i[e].opacity),a.appendTo(c)}}}var c={},i=document.querySelector("button.js-download"),o=document.querySelector("#house");document.querySelector("canvas");i.addEventListener("click",function(){var a=document.getElementById("canvas"),t=a.getContext("2d"),l=(new XMLSerializer).serializeToString(o),c=window.URL||window.webkitURL||window,i=new Image,n=new Blob([l],{type:"image/svg+xml;charset=utf-8"}),s=c.createObjectURL(n);i.src=s,i.onload=function(){a.width=1900,a.height=950,t.drawImage(i,0,0),c.revokeObjectURL(s);var l=a.toDataURL("image/png").replace("image/png","image/octet-stream");e(l)}}),$(document).on("click",".js-download",function(e){e.preventDefault()}),$(document).on("click",".bin_calc-panel__list-item",function(e){let a=$(this).data("color"),t=$(this).data("svg");$(this).addClass("bin_calc-panel__list-item--active").siblings().removeClass("bin_calc-panel__list-item--active"),$(".js-bin_calc-panel__colors[data-type='"+a+"']").addClass("bin_calc-panel__colors--active").siblings().removeClass("bin_calc-panel__colors--active"),$(".js-bin_calc-panel__colors[data-type='"+a+"'] .bin_calc-panel__colors-item").removeClass("bin_calc-panel__colors-item--active"),c[t].color&&$(".js-bin_calc-panel__colors[data-type='"+a+"'] .bin_calc-panel__colors-item[data-color_id='"+c[t].color_id+"']").addClass("bin_calc-panel__colors-item--active")}),$(document).on("click",".bin_calc-panel__colors-item",function(e){let t=$(".bin_calc-panel__list-item--active").data("svg");$(this).hasClass("bin_calc-panel__colors-item--active")?(c[t].color="none",c[t].color_id="",$(this).removeClass("bin_calc-panel__colors-item--active"),$(".bin_calc-panel__list-item.bin_calc-panel__list-item--active").removeClass("bin_calc-panel__list-item--selected")):(c[t].color=$(this).data("rgb"),c[t].color_id=$(this).data("color_id"),$(this).addClass("bin_calc-panel__colors-item--active").siblings().removeClass("bin_calc-panel__colors-item--active"),$(".bin_calc-panel__list-item.bin_calc-panel__list-item--active").addClass("bin_calc-panel__list-item--selected")),a()}),$.getJSON("/assets/js/bin_calc_colors.json",function(e){t(e),l(e)})});